//controller 
  const express = require('express');
const router = express.Router();
const db = require('../config/database');

// GET notifications for a specific user
router.get('/notifications', async (req, res) => {
  const userId = req.user.id; // Assuming authenticated user's ID is available in req.user

  try {
    const notifications = await getNotifications(userId);
    res.render('notifications', { notifications });
  } catch (error) {
    console.error('Error fetching notifications:', error);
    res.status(500).send('Internal Server Error');
  }
});

// Fetch notifications from database
async function getNotifications(userId) {
  const sql = `
    SELECT n.*, u.username, t.content AS tweetContent
    FROM notifications n
    LEFT JOIN users u ON n.related_user_id = u.id
    LEFT JOIN tweets t ON n.tweet_id = t.id
    WHERE n.user_id = ?
    ORDER BY n.created_at DESC
  `;

  return new Promise((resolve, reject) => {
    db.query(sql, [userId], (err, results) => {
      if (err) {
        reject(err);
      } else {
        resolve(results);
      }
    });
  });
}

module.exports = router;

//ejs

<!-- notifications.ejs -->
<section class="w-3/5 border border-gray-200 max-w-screen-sm min-h-dvh">
  <div class="font-medium flex justify-around rounded-lg text-start p-8">
    <span class="mt-2 font-medium text-xl">Notification</span>
    <img
      class="p-1 w-10 h-10 rounded-full"
      src="/assets/notification.gif"
      alt="Bordered avatar"
    />
  </div>
  
  <% notifications.forEach(notification => { %>
    <div class="block w-full px-4 py-2 border-b border-gray-200 cursor-pointer hover:bg-gray-100 hover:text-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-700 focus:text-blue-700">
      <div class="flex">
        <img
          class="w-10 h-10 p-1 rounded-full"
          src="<%= notification.avatarUrl %>"
          alt="Bordered avatar"
        />
        <div class="mt-2">
          <% if (notification.type === 'login') { %>
            There was a login to your account <%= notification.username %> from a new device on <%= notification.date %>. Review it now.
          <% } else if (notification.type === 'password_reset') { %>
            Your password was reset on your account. Based on this change, additional changes to your account may be restricted temporarily.
          <% } else if (notification.type === 'follow') { %>
            <%= notification.username %> followed you
          <% } else if (notification.type === 'like') { %>
            <img
              class="w-15 h-10 p-1 rounded-full"
              src="/assets/heart.png"
              alt="like icon"
            />
            <%= notification.username %> liked your Tweet
            <div class="mt-2"><%= notification.tweetContent %></div>
          <% } %>
        </div>
      </div>
    </div>
  <% }); %>

</section>
// front ens JavaScript 
  // frontend.js
document.addEventListener('DOMContentLoaded', () => {
  const loadNotifications = async () => {
    try {
      const response = await fetch('/notifications');
      const notifications = await response.json();
      
      // Assuming the notifications are returned as JSON from the backend
      const notificationsContainer = document.getElementById('allusercontent');
      notificationsContainer.innerHTML = ''; // Clear previous content

      notifications.forEach(notification => {
        const notificationDiv = document.createElement('div');
        notificationDiv.classList.add('block', 'w-full', 'px-4', 'py-2', 'border-b', 'border-gray-200', 'cursor-pointer', 'hover:bg-gray-100', 'hover:text-blue-700', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-700', 'focus:text-blue-700');

        const content = `
          <div class="flex">
            <img class="w-10 h-10 p-1 rounded-full" src="${notification.avatarUrl}" alt="Bordered avatar" />
            <div class="mt-2">${notification.content}</div>
          </div>
        `;

        notificationDiv.innerHTML = content;
        notificationsContainer.appendChild(notificationDiv);
      });
    } catch (error) {
      console.error('Error loading notifications:', error);
    }
  };

  // Example: Trigger loading notifications when a button is clicked
  const allUserLink = document.getElementById('alluser');
  allUserLink.addEventListener('click', loadNotifications);
});
